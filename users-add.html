<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
    <meta charset="utf-8" />
    <title>{{title}}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no" />
    <link rel="apple-touch-icon" href="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/pages/ico/60.png">
    <link rel="apple-touch-icon" sizes="76x76" href="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/pages/ico/76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/pages/ico/120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/pages/ico/152.png">
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta content="" name="description" />
    <meta content="" name="author" />
    <link href="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/pace/pace-theme-flash.css" rel="stylesheet" type="text/css" />
    <link href="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/bootstrapv3/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/font-awesome/css/font-awesome.css" rel="stylesheet" type="text/css" />
    <link href="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/jquery-scrollbar/jquery.scrollbar.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/switchery/css/switchery.min.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/pages/css/pages-icons.css" rel="stylesheet" type="text/css">
    <link class="main-stylesheet" href="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/pages/css/pages.css" rel="stylesheet" type="text/css" />
    <link href="public/css/styles.css" rel="stylesheet">
    <!--[if lte IE 9]>
        <link href="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/pages/css/ie9.css" rel="stylesheet" type="text/css" />
    <![endif]-->
    <script type="text/javascript">
    window.onload = function()
    {
      // fix for windows 8
      if (navigator.appVersion.indexOf("Windows NT 6.2") != -1)
        document.head.innerHTML += '<link rel="stylesheet" type="text/css" href="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/pages/css/windows.chrome.fix.css" />'
    }
    </script>
  </head>
  <body class="fixed-header ">
    <div class="register-container full-height sm-p-t-30">
      <div class="container-sm-height full-height">
        <div class="row row-sm-height">
          <div class="col-sm-12 col-sm-height col-middle">
            <!--<div class="view-heading">{{sub_title}}</div>-->
            <h3>{{sub_title}}</h3>

            <form enctype="multipart/form-data" 
              method="post" action="{{protocol}}://{{host}}:{{bolt_port}}/api/users">
              <div class="row">
                <div class="col-sm-12">
                  <div class="form-group form-group-default">
                    <label>User name</label>
                    <input type="text" name="name" id="name" placeholder="must be unique in the system" class="form-control" required>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-sm-12">
                  <div class="form-group form-group-default">
                    <label>Password</label>
                    <input type="password" name="password" id="password" placeholder="user being added should type this themselves" class="form-control" required>
                  </div>
                </div>
              </div>

              <hr />

              <div class="row">
                <div class="col-sm-12">
                  <div class="form-group form-group-default">
                    <label>Display name</label>
                    <input type="text" name="dn" id="dn" placeholder="this is what people will see" class="form-control">
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-sm-12">
                  <div class="form-group form-group-default">
                    <label>Email</label>
                    <input type="email" name="email" id="email" placeholder="We may send various info to you" class="form-control" required>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-sm-12">
                  <div class="form-group form-group-default">
                    <label>Phone</label>
                    <input type="tel" name="phone" id="phone" placeholder="We may send various info to you" class="form-control" required>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-xs-12">
                  <div class="panel panel-default">
                    <div class="panel-body">
                      <span class="glyphicon glyphicon-cloud-upload"></span>
                      <h2>Display picture</h2>
                      <h4>file uploader</h4>
                      <div class="progress">
                        <div class="progress-bar" role="progressbar"></div>
                      </div>
                      <button class="btn btn-lg pick-btn" type="button">Choose pic</button>
                    </div>
                  </div>
                </div>
              </div>

              <input type="file" name="dp" id="dp" class="form-control">

              <!--<button class="btn btn-primary btn-cons m-t-10" type="submit">Create new user</button>-->
            </form>
            <button class="btn btn-primary btn-cons m-t-10" type="submit" id="submit" name="submit">Create new user</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- BEGIN VENDOR JS -->
    <script src="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/pace/pace.min.js" type="text/javascript"></script>
    <script src="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/jquery/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/modernizr.custom.js" type="text/javascript"></script>
    <script src="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
    <script src="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/bootstrapv3/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/jquery/jquery-easy.js" type="text/javascript"></script>
    <script src="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/jquery-unveil/jquery.unveil.min.js" type="text/javascript"></script>
    <script src="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/jquery-bez/jquery.bez.min.js"></script>
    <script src="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/jquery-ios-list/jquery.ioslist.min.js" type="text/javascript"></script>
    <script src="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/jquery-actual/jquery.actual.min.js"></script>
    <script src="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/jquery-scrollbar/jquery.scrollbar.min.js"></script>
    <script type="text/javascript" src="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/select2/js/select2.full.min.js"></script>
    <script type="text/javascript" src="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/classie/classie.js"></script>
    <script src="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/switchery/js/switchery.min.js" type="text/javascript"></script>
    <script src="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/assets/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
    <!-- END VENDOR JS -->
    <script src="{{protocol}}://{{host}}:{{bolt_port}}/public/bolt/pages/pages/js/pages.min.js"></script>
    <script>
    $(function()
    {
      $('#form-register').validate()
    })

    $(document).ready(function(){
        $('.pick-btn').on('click', function (){
            $('#dp').click();
            $('.progress-bar').text('0%');
            $('.progress-bar').width('0%');
        });

        // create a FormData object which will be sent as the data payload in the
        // AJAX request
        var formData = new FormData();

        $('#dp').on('change', function(){
          var files = $(this).get(0).files;

          if (files.length > 0){
            // loop through all the selected files and add them to the formData object
            for (var i = 0; i < files.length; i++) {
              var file = files[i];

              // add the files to formData object for the data payload
              formData.append('dp', file, file.name);
            }
          }
        });
      //////////////////////////////
        $("#submit").click(function(){
            var username = $("#name").val();
            var password = $("#password").val();
            var displayname = $("#dn").val();
            var email = $("#email").val();
            var phone = $("#phone").val();
            /*
            * Perform some validation here.
            */

            formData.append('name', username);
            formData.append('password', password);
            formData.append('dn', displayname);
            formData.append('email', email);
            formData.append('phone', phone);

            $.ajax({
              url: '{{protocol}}://{{host}}:{{bolt_port}}/api/users',
              type: 'POST',
              data: formData,
              processData: false,
              contentType: false, //'multipart/form-data',
              beforeSend: function(xhr) {
                xhr.setRequestHeader('X-Bolt-Req-Id', '{{reqid}}');
              },
              success: function(response){
                if(response.code == 0){
                  window.location.href="{{protocol}}://{{host}}:{{my_port}}/users";
                }
                else {
                  //TODO: error
                  console.log(response);
                }
              },
              error: function(xhr, status, err){},
              xhr: function() {
                // create an XMLHttpRequest
                var xhr = new XMLHttpRequest();

                // listen to the 'progress' event
                xhr.upload.addEventListener('progress', function(evt) {

                  if (evt.lengthComputable) {
                    // calculate the percentage of upload completed
                    var percentComplete = evt.loaded / evt.total;
                    percentComplete = parseInt(percentComplete * 100);

                    // update the Bootstrap progress bar with the new percentage
                    $('.progress-bar').text(percentComplete + '%');
                    $('.progress-bar').width(percentComplete + '%');

                    // once the upload reaches 100%, set the progress bar text to done
                    if (percentComplete === 100) {
                      $('.progress-bar').html('Done');
                    }

                  }

                }, false);

                return xhr;
              }
            });
        });
      });
    </script>
  </body>
</html>