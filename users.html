<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
    <meta charset="utf-8" />
    <title>{{title}}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no" />
    <link rel="apple-touch-icon" href="pages/ico/60.png">
    <link rel="apple-touch-icon" sizes="76x76" href="pages/ico/76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="pages/ico/120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="pages/ico/152.png">
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta content="" name="description" />
    <meta content="" name="author" />
    <link href="assets/plugins/pace/pace-theme-flash.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/bootstrapv3/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/font-awesome/css/font-awesome.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/jquery-scrollbar/jquery.scrollbar.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="assets/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="assets/plugins/switchery/css/switchery.min.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="pages/css/pages-icons.css" rel="stylesheet" type="text/css">
    <link class="main-stylesheet" href="pages/css/pages.css" rel="stylesheet" type="text/css" />
    <!--[if lte IE 9]>
        <link href="pages/css/ie9.css" rel="stylesheet" type="text/css" />
    <![endif]-->
    <script type="text/javascript">
    window.onload = function()
    {
      // fix for windows 8
      if (navigator.appVersion.indexOf("Windows NT 6.2") != -1)
        document.head.innerHTML += '<link rel="stylesheet" type="text/css" href="pages/css/windows.chrome.fix.css" />'
    }
    </script>
  </head>
  <body class="fixed-header " style="border-color:#e6e6e6; border-width:1px 1px 0 1px; border-style:solid">
    <div class="view-port clearfix" id="chat">
      <div class="view bg-white">
        <!-- BEGIN View Header !-->
        <div class="navbar navbar-default">
          <div class="navbar-inner">
            <div class="view-heading">
              {{sub_title}}
            </div>
          </div>
        </div>
        <!-- END View Header !-->
        <div data-init-list-view="ioslist" class="list-view boreded no-top-border">
          <div class="list-view-group-container">
          <a type="submit" id="login-btn" class="btn btn-success" href="/users/add">New User</a>
            <ul>
              {{#each users}}
              <li class="chat-user-list clearfix">
                <a data-view-animation="push-parrallax" data-view-port="#chat" class="" href="/users/{{name}}">
                  <p class="p-l-10 col-xs-height col-middle col-xs-12 text-master">
                    {{displayName}} 
                    <a type="submit" id="login-btn" class="btn btn-danger pull-right" onclick="deleteUser('{{name}}')">Delete</a>
                    {{#if isBlocked}}
                      <a type="submit" id="login-btn" class="btn btn-danger pull-right" onclick="unblockUser('{{name}}')">Unblock</a>
                    {{else}}
                      <a type="submit" id="login-btn" class="btn btn-danger pull-right" onclick="blockUser('{{name}}')">Block</a>
                    {{/if}}
                    <a type="submit" id="login-btn" class="btn btn-primary pull-right" href="/users/roles/{{name}}">Roles...</a>
                  </p>
                </a>
              </li>
              {{/each}}
            </ul>
          </div>
        </div>
      </div>
    </div>
    <!-- BEGIN VENDOR JS -->
    <script src="assets/plugins/pace/pace.min.js" type="text/javascript"></script>
    <script src="assets/plugins/jquery/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="assets/plugins/modernizr.custom.js" type="text/javascript"></script>
    <script src="assets/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
    <script src="assets/plugins/bootstrapv3/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="assets/plugins/jquery/jquery-easy.js" type="text/javascript"></script>
    <script src="assets/plugins/jquery-unveil/jquery.unveil.min.js" type="text/javascript"></script>
    <script src="assets/plugins/jquery-bez/jquery.bez.min.js"></script>
    <script src="assets/plugins/jquery-ios-list/jquery.ioslist.min.js" type="text/javascript"></script>
    <script src="assets/plugins/jquery-actual/jquery.actual.min.js"></script>
    <script src="assets/plugins/jquery-scrollbar/jquery.scrollbar.min.js"></script>
    <script type="text/javascript" src="assets/plugins/select2/js/select2.full.min.js"></script>
    <script type="text/javascript" src="assets/plugins/classie/classie.js"></script>
    <script src="assets/plugins/switchery/js/switchery.min.js" type="text/javascript"></script>
    <!-- END VENDOR JS -->
    <!-- BEGIN CORE TEMPLATE JS -->
    <script src="pages/js/pages.min.js"></script>
    <!-- END CORE TEMPLATE JS -->
    <!-- BEGIN PAGE LEVEL JS -->
    <script src="assets/js/scripts.js" type="text/javascript"></script>
    <!-- END PAGE LEVEL JS -->
    <script>
    function deleteUser(username) {
      $.ajax({
        url: "{{protocol}}://{{host}}:{{bolt_port}}/api/users/" + username,
        type: "DELETE",
        beforeSend: function(xhr) {
          xhr.setRequestHeader('X-Bolt-Req-Id', '{{reqid}}');
        },
        success: function(response, status, xhr){
          if(response.code == 0){
            window.location.href="{{protocol}}://{{host}}:{{my_port}}/users";
          }
          else {
            //TODO: error
            console.log(response);
          }
        },
        error: function(xhr, status, err){}
      });
    }

    function blockUser(username) {
      $.ajax({
        url: "{{protocol}}://{{host}}:{{bolt_port}}/api/users/" + username,
        data: { isBlocked: true },
        type: "PUT",
        beforeSend: function(xhr) {
          xhr.setRequestHeader('X-Bolt-Req-Id', '{{reqid}}');
        },
        success: function(response, status, xhr){
          if(response.code == 0){
            window.location.href="{{protocol}}://{{host}}:{{my_port}}/users";
          }
          else {
            //TODO: error
            console.log(response);
          }
        },
        error: function(xhr, status, err){}
      });
    }

    function unblockUser(username) {
      $.ajax({
        url: "{{protocol}}://{{host}}:{{bolt_port}}/api/users/" + username,
        data: { isBlocked: false },
        type: "PUT",
        beforeSend: function(xhr) {
          xhr.setRequestHeader('X-Bolt-Req-Id', '{{reqid}}');
        },
        success: function(response, status, xhr){
          if(response.code == 0){
            window.location.href="{{protocol}}://{{host}}:{{my_port}}/users";
          }
          else {
            //TODO: error
            console.log(response);
          }
        },
        error: function(xhr, status, err){}
      });
    }
    </script>
  </body>
</html>